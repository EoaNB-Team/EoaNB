setup_initial_legitimacy = {
	randomize_temp_variable = {
		var = political_legitimacy_change
		distribution = uniform
		min = 0.6
		max = 0.8
	}
	if = {
		limit = { has_war = yes }
		subtract_from_temp_variable = { political_legitimacy_change = 0.05 }
	}
	eoanb_political_legitimacy_change = yes
	add_dynamic_modifier = { modifier = legitimacy_dynamic_modifier }
}

eoanb_political_legitimacy_change = {
	custom_effect_tooltip = eoanb_political_legitimacy_change_tt
	add_to_variable = { political_legitimacy = political_legitimacy_change }

	set_temp_variable = { full_legitimacy_temp_value = -0.70 }
	add_to_temp_variable = { full_legitimacy_temp_value = political_legitimacy }
	clamp_variable = {
		var = political_legitimacy
		min = 0
		max = 1
	}
	set_variable = { legitimacy_ppg = full_legitimacy_temp_value }
	divide_temp_variable = { full_legitimacy_temp_value = 2 }
	set_variable = { legitimacy_wsf = full_legitimacy_temp_value }

	if = {
		limit = { 
			NOT = { has_country_flag =  LOW_LEGITIMACY_PS_DELAY }
			OR = {
				AND = {
					check_variable = { political_legitimacy < 10 }
					check_variable = { pol_stability > -3 }
				}
				AND = {
					check_variable = { political_legitimacy < 25 }
					check_variable = { pol_stability > -2 }
				}
				AND = {
					check_variable = { political_legitimacy < 40 }
					check_variable = { pol_stability > -1 }
				}
			}
		}				
		decrease_ps_by_one = yes
		set_country_flag = LOW_LEGITIMACY_PS_DELAY
		country_event = { id = pssystem_legitimacy_interaction.1 days = 365 }
	}
	else_if = {
		limit = { 
			NOT = { has_country_flag =  HIGH_LEGITIMACY_PS_DELAY }
			OR = {
				AND = {
					check_variable = { political_legitimacy > 75 }
					check_variable = { pol_stability < 1 }
				}
				AND = {
					check_variable = { political_legitimacy >95 }
					check_variable = { pol_stability > 2 }
				}
			}
		}				
		increase_ps_by_one = yes
		set_country_flag = HIGH_LEGITIMACY_PS_DELAY
		country_event = { id = pssystem_legitimacy_interaction.2 days = 365 }
	}
}