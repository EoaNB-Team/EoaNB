add_namespace = shogunate_japan
add_namespace = shogunate_japan_fl
add_namespace = shogunate_japan_l
add_namespace = shogunate_japan_ansei
add_namespace = shogunate_japan_boshin_anticheat
add_namespace = shogunate_japan_choshu
add_namespace = shogunate_japan_boshin
add_namespace = tsh_news
#Intro
country_event = {
	id = shogunate_japan.0
	title = shogunate_japan.0.t
	desc = shogunate_japan.0.d

	is_triggered_only = yes

	option = {
		name = shogunate_japan.0.a
	}
}

#Harris Treaty Intro
country_event = {
	id = shogunate_japan.1
	title = shogunate_japan.1.t
	desc = shogunate_japan.1.d

	fire_only_once = yes

	is_triggered_only = yes

#We must convince the Emperor!
	option = {
		name = shogunate_japan.1.a
		ai_chance = { factor = 95 }
		TSH = { country_event = { days = 7 id = shogunate_japan.2 } }
	}

	#The Shogun rules, not the Emperor!
	option = {
		name = shogunate_japan.1.b
		ai_chance = { factor = 5 }
		hidden_effect = { news_event = { id = news.17 } }
		add_political_power = -50
		set_country_flag = harris_treaty_signed
	}
}

#Harris Treaty Emperor
country_event = {
	id = shogunate_japan.2
	title = shogunate_japan.2.t
	desc = shogunate_japan.2.d

	fire_only_once = yes

	is_triggered_only = yes

	option = {
		name = shogunate_japan.2.a
		hidden_effect = { news_event = { id = news.17 } }
		add_political_power = -50
		add_stability = 0.005
		set_country_flag = harris_treaty_signed
		#Add Court Influence
	}
}

##FOCUS TREE EVENTS##
#monetary policy
country_event = {
	    id = shogunate_japan.3
	    title = shogunate_japan.3.t
	    desc = shogunate_japan.3.d

	    fire_only_once = yes

	    is_triggered_only = yes

	    option = {
	    	name = shogunate_japan.3.a
	    	##placeholder
	    }
}

#western_military_treatises
country_event = {
	    id = shogunate_japan.4
	    title = shogunate_japan.4.t
	    desc = shogunate_japan.4.d

	    fire_only_once = yes

	    is_triggered_only = yes

	    option = {
	    	name = shogunate_japan.4.a
	    	##placeholder
	    }
}

#invite foreign expertise
country_event = {
	    id = shogunate_japan.5
	    title = shogunate_japan.5.t
	    desc = shogunate_japan.5.d

	    fire_only_once = yes

	    is_triggered_only = yes

	    option = {
	    	name = shogunate_japan.5.a
	    	##placeholder
	    }
}

#military budget realocations
country_event = {
	    id = shogunate_japan.6
	    title = shogunate_japan.6.t
	    desc = shogunate_japan.6.d

	    fire_only_once = yes

	    is_triggered_only = yes

	    option = {
	    	name = shogunate_japan.6.a
	    	##placeholder
	    }
}

#kaigun denshujo
country_event = {
	    id = shogunate_japan.7
	    title = shogunate_japan.7.t
	    desc = shogunate_japan.7.d

	    fire_only_once = yes

	    is_triggered_only = yes

	    option = {
	    	name = shogunate_japan.7.a
	    	##placeholder
	    }
}

#fate of kaigun denshujo
country_event = {
	    id = shogunate_japan.8
	    title = shogunate_japan.8.t
	    desc = shogunate_japan.8.d

	    fire_only_once = yes

	    is_triggered_only = yes

	    option = {
	    	name = shogunate_japan.8.a
	    	##placeholder
	    }
}

#cadets abroad
country_event = {
	    id = shogunate_japan.9
	    title = shogunate_japan.9.t
	    desc = shogunate_japan.9.d

	    is_triggered_only = yes

	    option = {
	    	name = shogunate_japan.9.a
			    hidden_effect = {
	    	    country_event = { id = shogunate_japan.10 days = 365 }
	    }
    }
}

#cadets abroad return
country_event = {
	    id = shogunate_japan.10
	    title = shogunate_japan.10.t
	    desc = shogunate_japan.10.d

	    fire_only_once = yes

	    is_triggered_only = yes

	    option = {
	    	name = shogunate_japan.10.a
	    	    add_tech_bonus = { bonus = 0.20 uses = 2 category = industry }
			    add_tech_bonus = { bonus = 0.20 uses = 2 category = artillery }
				add_tech_bonus = { bonus = 0.20 uses = 2 category = naval_equipment }
	    }
    }

#foreign steamship deal
country_event = {
	    id = shogunate_japan.11
	    title = shogunate_japan.11.t
	    desc = shogunate_japan.11.d

	    fire_only_once = yes

	    is_triggered_only = yes

	    option = {
	    	name = shogunate_japan.11.a
	    	##placeholder
	    }
}

#ironclad deal
country_event = {
	    id = shogunate_japan.12
	    title = shogunate_japan.12.t
	    desc = shogunate_japan.12.d

	    fire_only_once = yes

	    is_triggered_only = yes

	    option = {
	    	name = shogunate_japan.12.a
	    	##placeholder
	    }
}

#shanghai docking rights request
country_event = {
	    id = shogunate_japan.13
	    title = shogunate_japan.13.t
	    desc = shogunate_japan.13.d

	    fire_only_once = yes

	    is_triggered_only = yes

	    option = {
	    	name = shogunate_japan.13.a
	    	##placeholder
	    }
}

#Purchase of Rangaku books
country_event = {
		id = shogunate_japan.15
		title = shogunate_japan.15.t
		desc = shogunate_japan.15.d

		fire_only_once = yes

		is_triggered_only = yes

		option = {
			name = shogunate_japan.15.a
			add_political_power = 120
			custom_effect_tooltip = EDC_afr.5.t
			hidden_effect = {
				country_event = { id = EDC_afr.5 hours = 1 }
			}
		}
}

#Cholera Outbreak!
country_event = {
		id = shogunate_japan.16
		title = shogunate_japan.16.t
		desc = shogunate_japan.16.d

		fire_only_once = yes

		trigger = {
			has_country_flag = harris_treaty_signed
			OR = {
				has_country_flag = ii_is_tairo
				has_country_flag = matsudaira_is_tairo
			}
			date > 1858.7.1
		}

		#The Gods scorn us!
		option = {
			name = shogunate_japan.16.a

			ai_chance = { factor = 100 }

			add_stability = -0.02
			add_timed_idea = { idea = TSH_cholera_outbreak_1858 days = 712 }
			hidden_effect = { TSH = { country_event = { days = 14 id = shogunate_japan_l.8 } } }
		}
}

#Kabunakama Monopoly Question
country_event = {
		id = shogunate_japan.17
		title = shogunate_japan.17.t
		desc = shogunate_japan.17.d

		is_triggered_only = yes

		option = {
			name = shogunate_japan.17.a
			    add_political_power = -100
			    remove_ideas = TSH_kabunakama_monopolies
		}

		option = {
			name = shogunate_japan.17.b
			    add_political_power = 25
		}

		option = {
			name = shogunate_japan.17.c
			    add_political_power = -25
		        swap_ideas = {
				    add_idea = TSH_kabunakama_monopolies_1
				    remove_idea = TSH_kabunakama_monopolies
			}
		}
    }

#Students Abroad
country_event = {
	    id = shogunate_japan.18
	    title = shogunate_japan.18.t
	    desc = shogunate_japan.18.d

	    is_triggered_only = yes

	    option = {
	    	name = shogunate_japan.18.a
			    hidden_effect = {
					country_event = { id = shogunate_japan.19 days = 365 }
				}
				custom_effect_tooltip = TSH_students_depart_tt
		}
	}

#Students return home
country_event = {
	    id = shogunate_japan.19
	    title = shogunate_japan.19.t
	    desc = shogunate_japan.19.d

	    fire_only_once = yes

	    is_triggered_only = yes

	    option = {
	    	name = shogunate_japan.19.a
	    	    add_tech_bonus = { bonus = 0.20 uses = 2 category = chemistry_tech }
			    add_tech_bonus = { bonus = 0.20 uses = 2 category = mechanical_engineering_tech }
	    }
    }
	
#Addressing the Court and the Sonno Joi
country_event = {
	    id = shogunate_japan.20
	    title = shogunate_japan.20.t
	    desc = shogunate_japan.20.d

	    fire_only_once = yes

	    is_triggered_only = yes

	    option = {
	    name = shogunate_japan.20.a
		if = {
		    limit = {
            date < 1867.1.30
            }
			add_ideas = JAP_komei
		else_if = {
            limit = {
            date > 1867.1.30
            }
            add_ideas = JAP_mutsuhito
            }
        }
    }
}

#Prussian Ship
country_event = {
	    id = shogunate_japan.21
	    title = shogunate_japan.21.t
	    desc = shogunate_japan.21.d

	    fire_only_once = yes

	    is_triggered_only = yes

	    option = {
	    name = shogunate_japan.21.a
		PRS ={ transfer_ship ={ prefer_name = "SMS Danzig" type = corvette target = TSH } }
		add_opinion_modifier = { target = PRS modifier = TSH_naval_contacts }
		reverse_add_opinion_modifier = { target = TSH modifier = TSH_naval_contacts }
		}
		
		option = {
	    name = shogunate_japan.21.b
        }
    }

#American Ship
country_event = {
	    id = shogunate_japan.22
	    title = shogunate_japan.22.t
	    desc = shogunate_japan.22.d

	    fire_only_once = yes

	    is_triggered_only = yes

	    option = {
	    name = shogunate_japan.22.a
		USA ={ transfer_ship ={ prefer_name = "St. Louis" type = corvette target = TSH } }
		add_opinion_modifier = { target = USA modifier = TSH_naval_contacts }
		reverse_add_opinion_modifier = { target = TSH modifier = TSH_naval_contacts }
        }
		
		option = {
	    name = shogunate_japan.22.b
		
        }
    }

#British Ship
country_event = {
	    id = shogunate_japan.23
	    title = shogunate_japan.23.t
	    desc = shogunate_japan.23.d

	    fire_only_once = yes

	    is_triggered_only = yes

	    option = {
	    name = shogunate_japan.23.a
		ENG ={ transfer_ship ={ prefer_name = "HMS Imperieuse" type = frigate target = TSH } }
		add_opinion_modifier = { target = ENG modifier = TSH_naval_contacts }
		reverse_add_opinion_modifier = { target = TSH modifier = TSH_naval_contacts }
        }
		
		option = {
	    name = shogunate_japan.23.b
		
        }
    }

###LEADER ABDICATION###

#Tokugawa Iesada's rule comes into question, succession comes up.
country_event = {
		id = shogunate_japan_l.0
		title = shogunate_japan_l.0.t
		desc = shogunate_japan_l.0.d

		fire_only_once = yes

		is_triggered_only = yes

		#The future is bleak...
		option = {
			name = shogunate_japan_l.0.a

			ai_chance = { factor = 100 }
			hidden_effect = {
				TSH = { country_event = { days = 5 id = shogunate_japan_l.1 } }
				complete_national_focus = TSH_vic_the_illness_of_shogun_iesada
			}
			custom_effect_tooltip = TSH_shogun_weakness_tt
	}
}

#Battle for the Shogunate
country_event = {
		id = shogunate_japan_l.1
		title = shogunate_japan_l.1.t
		desc = shogunate_japan_l.1.d

		fire_only_once = yes

		is_triggered_only = yes

		#The struggle begins...
		option = {
			name = shogunate_japan_l.1.a

			ai_chance = { factor = 1 }

			add_ideas = TSH_succession_struggle
			set_country_flag = succession_crisis_starts
			hidden_effect = {
				set_variable = { var = TSH.hitotsubashi_faction@TSH value = 20 }
				set_variable = { var = TSH.kishu_faction@TSH value = 20 }
				country_event = { days = 5 id = shogunate_japan_l.2 }
				country_event = { days = 10 id = shogunate_japan_l.3 }
				country_event = { days = 15 id = shogunate_japan_l.4 }
				country_event = { days = 20 id = shogunate_japan_l.5 }
				activate_mission = TSH_mission_pick_heir
				}
              
			custom_effect_tooltip = TSH_shogun_debate_start_tt
		}
}

#Tozama and Mito Camp sends emissaries to Kyoto
country_event = {
		id = shogunate_japan_l.2
		title = shogunate_japan_l.2.t
		desc = shogunate_japan_l.2.d

		fire_only_once = yes

		is_triggered_only = yes

		#Keiki strikes first!
		option = { #Adds Imperial Support for the Tokugawa
			name = shogunate_japan_l.2.a

			ai_chance = { factor = 1 }
			custom_effect_tooltip = TSH_keiki_1_tt
            add_to_variable = { var = TSH.hitotsubashi_faction@TSH value = 5 }
			add_to_variable = { var = TSH.kishu_faction@TSH value = -5 }
		}
}

#Hotta Masayoshi supports Keiki
country_event = {
		id = shogunate_japan_l.3
		title = shogunate_japan_l.3.t
		desc = shogunate_japan_l.3.d

		fire_only_once = yes

		is_triggered_only = yes

		#Can Keiki defeat Yoshitomi?
		option = { #Adds Imperial Support for the Tokugawa
			name = shogunate_japan_l.3.a

			ai_chance = { factor = 1 }
			custom_effect_tooltip = TSH_keiki_2_tt
			add_to_variable = { var = TSH.hitotsubashi_faction@TSH value = 5 }
			add_to_variable = { var = TSH.kishu_faction@TSH value = -5 }
		}
 }

#Fudai Lords push back!
country_event = {
		id = shogunate_japan_l.4
		title = shogunate_japan_l.4.t
		desc = shogunate_japan_l.4.d

		fire_only_once = yes

		is_triggered_only = yes

		#The Fudai make their move!
		option = { #Adds Shogunate Support for the Tokugawa
			name = shogunate_japan_l.4.a

			ai_chance = { factor = 90 }
			custom_effect_tooltip = TSH_yoshitomi_1_tt
            add_to_variable = { var = TSH.hitotsubashi_faction@TSH value = -5 }
			add_to_variable = { var = TSH.kishu_faction@TSH value = 10 }
			if = {
			    limit = { check_variable = { TSH.kishu_faction@TSH > TSH.hitotsubashi_faction@TSH }  }
				add_political_power = -50
			}
		}
		
		#Stop them!
		option = {
			name = shogunate_japan_l.4.b

			ai_chance = { factor = 10 }
            add_to_variable = { var = TSH.hitotsubashi_faction@TSH value = 5 }
			add_to_variable = { var = TSH.kishu_faction@TSH value = -10 }
			if = {
			    limit = { check_variable = { TSH.hitotsubashi_faction@TSH > TSH.kishu_faction@TSH }  }
				add_political_power = -50
			}
		}
 }
 
#Revocation of the Imperial decree
country_event = {
		id = shogunate_japan_l.5
		title = shogunate_japan_l.5.t
		desc = shogunate_japan_l.5.d

		fire_only_once = yes

		is_triggered_only = yes

		#A major setback for Keiki
		option = { #Reduces Imperial Support for the Tokugawa
			name = shogunate_japan_l.5.a

			ai_chance = { factor = 90 }
			custom_effect_tooltip = TSH_yoshitomi_2_tt
            add_to_variable = { var = TSH.hitotsubashi_faction@TSH value = -5 }
			add_to_variable = { var = TSH.kishu_faction@TSH value = 10 }
			if = {
			    limit = { check_variable = { TSH.kishu_faction@TSH > TSH.hitotsubashi_faction@TSH }  }
				add_political_power = -50
			}
		}
		option = { #Is it necessary?
			name = shogunate_japan_l.5.b

			ai_chance = { factor = 10 }
            add_to_variable = { var = TSH.hitotsubashi_faction@TSH value = 5 }
			add_to_variable = { var = TSH.kishu_faction@TSH value = -10 }
			if = {
			    limit = { check_variable = { TSH.hitotsubashi_faction@TSH > TSH.kishu_faction@TSH }  }
				add_political_power = -50
			}
		}
    }

#Ii Naosuke becomes Tairō
country_event = { #Naosuke becoming Tairō means that Iemochi becomes Shogun without doubt.
		id = shogunate_japan_l.6
		title = shogunate_japan_l.6.t
		desc = shogunate_japan_l.6.d

		fire_only_once = yes

        is_triggered_only = yes

		#The Tairō takes the helm
		option = {
			name = shogunate_japan_l.6.a

			ai_chance = { factor = 1 }
			hidden_effect = {
				TSH = { country_event = { days = 20 id = shogunate_japan_l.8 } }
				retire_country_leader = yes
			}

			set_country_flag = ii_is_tairo
			set_country_flag = succession_crisis_ends

			custom_effect_tooltip = TSH_ii_regent_tt

			create_country_leader = {
				name = "Ii Naosuke"
				desc = "POLITICS_GENERIC_EOANB_DESC"
				picture = "gfx/leaders/TSH/Portrait_TSH_Ii_Naosuke.dds"
				expire = "1900.1.1"
				ideology = despotism
				traits = { }
			}

			create_country_leader = {
				name = "Ii Naosuke"
				desc = "POLITICS_GENERIC_EOANB_DESC"
				picture = "gfx/leaders/TSH/Portrait_TSH_Ii_Naosuke.dds"
				expire = "1900.1.1"
				ideology = shogunate
				traits = { }
			}

		}
}

#Matsudaira Shungaku becomes Tairō
country_event = { #Matsudaira becoming Tairō means that Keiki becomes Shogun without doubt.
		id = shogunate_japan_l.7
		title = shogunate_japan_l.7.t
		desc = shogunate_japan_l.7.d

		fire_only_once = yes

        is_triggered_only = yes

		#An important lynchpin...
		option = {
			name = shogunate_japan_l.7.a
			ai_chance = { factor = 1 }

			hidden_effect = {
				TSH = { country_event = { days = 20 id = shogunate_japan_l.8 } }
				retire_country_leader = yes
			}

			set_country_flag = matsudaira_is_tairo
			set_country_flag = succession_crisis_ends

			custom_effect_tooltip = TSH_matsudaira_regent_tt
			
			create_country_leader = {
				name = "Matsudaira Shungaku"
				desc = "POLITICS_GENERIC_EOANB_DESC"
				picture = "gfx/leaders/TSH/Portrait_TSH_Matsudaira_Shungaku.dds"
				expire = "1900.1.1"
				ideology = despotism
				traits = { }
			}

			create_country_leader = {
				name = "Matsudaira Shungaku"
				desc = "POLITICS_GENERIC_EOANB_DESC"
				picture = "gfx/leaders/TSH/Portrait_TSH_Matsudaira_Shungaku.dds"
				expire = "1900.1.1"
				ideology = shogunate
				traits = { }
			}

		}
}

#Iesada Shogun Dies!
country_event = { #The Shogun Dies, and the succession begins.
		id = shogunate_japan_l.8
		title = shogunate_japan_l.8.t
		desc = shogunate_japan_l.8.d

		fire_only_once = yes

		is_triggered_only = yes

		#The Shogun is dead!
		option = {
			name = shogunate_japan_l.8.a
			ai_chance = { factor = 1 }

			hidden_effect = {
				TSH = { country_event = { days = 15 id = shogunate_japan_l.9 } }
			}

			add_stability = -0.02
			add_political_power = -10

			custom_effect_tooltip = TSH_iesada_death_tt

		}
}

#Shogun Selection event
country_event = {
		id = shogunate_japan_l.9
		title = shogunate_japan_l.9.t
		desc = shogunate_japan_l.9.d

		fire_only_once = yes

		is_triggered_only = yes

		#Banzai! (Iemochi)
		option = {
			name = shogunate_japan_l.9.a
			trigger = { has_country_flag = ii_is_tairo }

			add_political_power = 100
			add_stability = 0.10

			ai_chance = { factor = 100 }

			hidden_effect = {
				country_event = { days = 2 id = tsh_news.0 }
			}
			
			complete_national_focus = TSH_vic_kii_shogun

			custom_effect_tooltip = TSH_shogun_death_iemochi_tt

		}

		#Banzai! (Yoshinobu)
		option = {
			name = shogunate_japan_l.9.b
			trigger = { has_country_flag = matsudaira_is_tairo }

			add_political_power = 100
			add_stability = 0.10

			ai_chance = { factor = 100 }

			hidden_effect = {
				country_event = { days = 2 id = tsh_news.0 }
				retire_country_leader = yes
			}
			
			complete_national_focus = TSH_vic_hitotsubashi_shogun

			create_country_leader = {
				name = "Yoshinobu Tokugawa"
				desc = "POLITICS_GENERIC_EOANB_DESC"
				picture = "gfx/leaders/TSH/Portrait_TSH_Tokugawa_Yoshinobu.dds"
				expire = "1900.1.1"
				ideology = despotism
				traits = { }
			}

			create_country_leader = {
				name = "Yoshinobu Tokugawa"
				desc = "POLITICS_GENERIC_EOANB_DESC"
				picture = "gfx/leaders/TSH/Portrait_TSH_Tokugawa_Yoshinobu.dds"
				expire = "1900.1.1"
				ideology = shogunate
				traits = { }
			}

			custom_effect_tooltip = TSH_shogun_death_yoshinobu_tt

		}
}

###Ansei Purge

#Question of purge!
country_event = {
		id = shogunate_japan_ansei.1
		title = shogunate_japan_ansei.1.t
		desc = shogunate_japan_ansei.1.d

		trigger = {
		    has_country_flag = harris_treaty_signed
			has_country_leader = {
                name = "Ii Naosuke"
                ruling_only = yes
            }
		}
		
		fire_only_once = yes

		#Purge is necessary!
		option = {
			name = shogunate_japan_ansei.1.a
			ai_chance = { factor = 90 }

			hidden_effect = {
				SAT = { country_event = { days = 10 id = shogunate_japan_ansei.2 } }
				CHO = { country_event = { days = 10 id = shogunate_japan_ansei.2 } }
				complete_national_focus = TSH_vic_ansei_purge
		    }
        }
    }
	
#Satsuma Rebbelion!
country_event = {
		id = shogunate_japan_ansei.2
		title = shogunate_japan_ansei.2.t
		desc = shogunate_japan_ansei.1.d

        is_triggered_only = yes
		
		fire_only_once = yes

		#Naosuke should die!
		option = {
			name = shogunate_japan_ansei.2.a
            country_event = { days = 10 id = shogunate_japan_ansei.3 }
			TSH = {  country_event = { days = 5 id = shogunate_japan_ansei.5 } }
			add_ideas = CHO_vic_satsuma_rebbelion_2
		}
    }
	
#Satsuma Rebbelion! - Tokugawa/Choshu Side
country_event = {
		id = shogunate_japan_ansei.5
		title = shogunate_japan_ansei.5.t
		desc = shogunate_japan_ansei.5.d

        is_triggered_only = yes
		
		fire_only_once = yes

		#What??
		option = {
			name = shogunate_japan_ansei.5.a
			trigger = { tag = TSH }
			add_ideas = TSH_satsuma_rebbelion
			add_opinion_modifier = { target = SAT modifier = TSH_satsuma_rebellion }
			reverse_add_opinion_modifier = { target = SAT modifier = TSH_satsuma_rebellion }
			SAT = { country_event = { id = shogunate_japan_ansei.3 days = 10 }
		}
	}
		
		#Let's join Satsuma!
		option = {
			name = shogunate_japan_ansei.5.b
			trigger = { tag = CHO }
            ai_chance = { factor = 70 }
			add_ideas = CHO_vic_satsuma_rebbelion
			hidden_effect = {
			    add_opinion_modifier = { target = TSH modifier = eoanb_om_RUS_decrease_medium }
			    reverse_add_opinion_modifier = { target = TSH modifier = eoanb_om_RUS_decrease_medium }
			}
		}
		
		#It is too risky!
		option = {
			name = shogunate_japan_ansei.5.c
			trigger = { tag = CHO }
			ai_chance = { factor = 30 }
		}
	}
	
#Shimazu Nariakira inspection of army
country_event = {
		id = shogunate_japan_ansei.3
		title = shogunate_japan_ansei.3.t
		desc = shogunate_japan_ansei.3.d

        is_triggered_only = yes
		
		fire_only_once = yes

		
		#He got stroke from sun!
		option = {
			name = shogunate_japan_ansei.3.a
            ai_chance = { factor = 90 }
			hidden_effect = {
			    country_event = { days = 10 id = daimyo.1 }
                TSH = { country_event = { days = 10 id = shogunate_japan_ansei.4 } }
				CHO = { country_event = { days = 10 id = shogunate_japan_ansei.4 } }
			}
		}
		
		#Nariakira survived and ready to fight!
		option = {
			name = shogunate_japan_ansei.3.b
            ai_chance = { factor = 10 }
            country_event = { days = 10 id = shogunate_japan_ansei.6 }
		}
    }
	
#Choshu and Mito left Satsuma
country_event = {
		id = shogunate_japan_ansei.4
		title = shogunate_japan_ansei.4.t
		desc = shogunate_japan_ansei.4.d

        is_triggered_only = yes
		
		fire_only_once = yes

		#Choshu and Mito - secret deal with Tokugawa - Tokugawa Side
		option = {
			name = shogunate_japan_ansei.4.a
            trigger = { tag = TSH }
			remove_ideas = TSH_satsuma_rebbelion
		}
		
		#Choshu and Mito - secret deal with Tokugawa - Choshu Side
		option = {
			name = shogunate_japan_ansei.4.b
            trigger = { tag = CHO }
			remove_ideas = CHO_vic_satsuma_rebbelion
		}
    }
	
###Alt path where Nariakira survives
country_event = { ##Border Clash with Shogunate
		id = shogunate_japan_ansei.6
		title = shogunate_japan_ansei.6.t
		desc = shogunate_japan_ansei.6.d

        is_triggered_only = yes
		
		fire_only_once = yes

		#Here is border clash
		option = {
			name = shogunate_japan_ansei.6.a
            TSH = { end_puppet = SAT }
			remove_ideas = { CHO_vic_tozama_domain TSH_sankin_kotai_obligations }
			start_border_war = {
				change_state_after_war = no
				attacker = {
					state = 1054
					num_provinces = 1
					on_win = shogunate_japan_ansei.8
					on_lose = shogunate_japan_ansei.7
					}
					defender = {
					state = 528
					num_provinces = 7
					on_win = shogunate_japan_ansei.7
					on_lose = shogunate_japan_ansei.8
				}
			}
		}
    }

country_event = { ##Satsuma Lose - Nariakira is executed, history is normal later as it was irl
		id = shogunate_japan_ansei.7
		title = shogunate_japan_ansei.7.t
		desc = shogunate_japan_ansei.7.d

        is_triggered_only = yes
		
		fire_only_once = yes

		option = {
			name = shogunate_japan_ansei.7.a
			SAT = { country_event = { days = 5 id = daimyo.1 } }
			puppet = SAT
			SAT = { add_ideas = CHO_vic_tozama_domain }
			SAT = { add_ideas = TSH_sankin_kotai_obligations }
		}
    }

country_event = { ##Satsuma won
		id = shogunate_japan_ansei.8
		title = shogunate_japan_ansei.8.t
		desc = shogunate_japan_ansei.8.d

        is_triggered_only = yes
		
		fire_only_once = yes

		option = {
			name = shogunate_japan_ansei.8.a
            trigger = { tag = TSH }
		}
		
		option = {
			name = shogunate_japan_ansei.8.b
            trigger = { tag = SAT }
			transfer_state = 528
			country_event = { days = 5 id = shogunate_japan_ansei.9 }
			TSH = { country_event = { days = 5 id = shogunate_japan_ansei.9 } } }
		}

country_event = { ##March to Edo ! - normal war between Clans and Shogune
		id = shogunate_japan_ansei.9
		title = shogunate_japan_ansei.9.t
		desc = shogunate_japan_ansei.9.d

        is_triggered_only = yes
		
		fire_only_once = yes

		option = {
			name = shogunate_japan_ansei.9.a
            trigger = { tag = TSH }
		}
		
		option = {
			name = shogunate_japan_ansei.9.b
            trigger = { tag = SAT }
			declare_war_on = {
                       target = TSH
                       type = annex_everything
            }
			TSH = { end_puppet = CHO }
			CHO = { declare_war_on = {
                       target = TSH
                       type = annex_everything
            }
			CHO = { remove_ideas = CHO_vic_tozama_domain   }
		}
    }
}

###Ansei Purge -  rest of events

country_event = {
		id = shogunate_japan_ansei.10
		title = shogunate_japan_ansei.10.t
		desc = shogunate_japan_ansei.10.d

        trigger = {
		    has_active_mission = TSH_mission_purge_phase_1
			date > 1859.4.1
		}
		
		fire_only_once = yes

		option = {
			name = shogunate_japan_ansei.10.a
			remove_mission = TSH_mission_purge_phase_1
			set_country_flag = TSH_purge_phase_2
		}
		
		option = {
			name = shogunate_japan_ansei.10.b
    }
}

### FIRST CHOSHU EXPEDITION ###

#Kinmon incident
country_event = {
	id = shogunate_japan_choshu.1
	title = shogunate_japan_choshu.1.t
	desc = shogunate_japan_choshu.1.d
	
	is_triggered_only = yes
	
	#Launch Expedition
	option = {
		name = shogunate_japan_choshu.1.a
		ai_chance = { factor = 100 }
		SAT = { country_event = { id = shogunate_japan_choshu.2 days = 1 } }
	}
}

#Satsuma is called to arms
country_event = {
	id = shogunate_japan_choshu.2
	title = shogunate_japan_choshu.2.t
	desc = shogunate_japan_choshu.2.d
	
	is_triggered_only = yes
	
	#Satsuma supports expedition
	option = {
		name = shogunate_japan_choshu.2.a
		ai_chance = { factor = 50 }
		TSH = { country_event = { id = shogunate_japan_choshu.3 days = 1 } }
	}
	
	#Satsuma does not support expedition
	option = {
		name = shogunate_japan_choshu.2.b
		ai_chance = { factor = 50 }
		TSH = { country_event = { id = shogunate_japan_choshu.13 days = 1 } }
	}
}

#Shogunate notified Satsuma supports
country_event = {
	id = shogunate_japan_choshu.3
	title = shogunate_japan_choshu.3.t
	desc = shogunate_japan_choshu.3.d
	
	is_triggered_only = yes
	
	#Then let us begin
	option = {
		name = shogunate_japan_choshu.3.a
		ai_chance = { factor = 50 }
		SAT = { country_event = { id = shogunate_japan_choshu.4 days = 1 } }
		CHO = { country_event = { id = shogunate_japan_choshu.5 days = 1 } }
	}
	
}

#Shogunate expedition arrives in Satsuma
country_event = {
	id = shogunate_japan_choshu.4
	title = shogunate_japan_choshu.4.t
	desc = shogunate_japan_choshu.4.d
	
	is_triggered_only = yes
	
	#Ok
	option = {
		name = shogunate_japan_choshu.4.a
		ai_chance = { factor = 100 }
	}
	
}

#Shogunate expedition arrives in Choshu
country_event = {
	id = shogunate_japan_choshu.5
	title = shogunate_japan_choshu.5.t
	desc = shogunate_japan_choshu.5.d
	
	is_triggered_only = yes
	
	#Extradite responsible leaders
	option = {
		name = shogunate_japan_choshu.5.a
		ai_chance = { factor = 50 }
		# add_ideas = TSH_choshu_defeat
		TSH = { country_event = { id = shogunate_japan_choshu.6 days = 1 } }
	}
	
	#Refuse to accept responsibility
	option = {
		name = shogunate_japan_choshu.5.b
		ai_chance = { factor = 50 }
		TSH = { country_event = { id = shogunate_japan_choshu.7 days = 1 } }
	}
	
}

#Shogunate receives extradited leaders
country_event = {
	id = shogunate_japan_choshu.6
	title = shogunate_japan_choshu.6.t
	desc = shogunate_japan_choshu.6.d
	
	is_triggered_only = yes
	
	#Ok
	option = {
		name = shogunate_japan_choshu.6.a
		ai_chance = { factor = 100 }
		# add_ideas = TSH_upheld_authority
	}
	
}

#Shogunate receives news Choshu will not submit
country_event = {
	id = shogunate_japan_choshu.7
	title = shogunate_japan_choshu.7.t
	desc = shogunate_japan_choshu.7.d
	
	is_triggered_only = yes
	
	#Start the Border War
	option = {
		name = shogunate_japan_choshu.7.a
		ai_chance = { factor = 100 }
		start_border_war = {
			change_state_after_war = no
			attacker = {
				state = 1261
				num_provinces = 1
				on_win = shogunate_japan_choshu.11
				on_lose = shogunate_japan_choshu.9
				on_cancel = shogunate_japan_choshu.12
			}
			defender = {
				state = 1210
				num_provinces = 1
				on_win = shogunate_japan_choshu.8
				on_lose = shogunate_japan_choshu.10
				on_cancel = secondopiumwar.12
			}
		}
	}
	
}

#Choshu Wins
country_event = {
	id = shogunate_japan_choshu.8
	title = shogunate_japan_choshu.8.t
	desc = shogunate_japan_choshu.8.d
	
	is_triggered_only = yes
	
	#We prevail
	option = {
		name = shogunate_japan_choshu.8.a
		ai_chance = { factor = 100 }
		# add_ideas = TSH_righteous_fury
	}
	
}

#Shogunate Loses
country_event = {
	id = shogunate_japan_choshu.9
	title = shogunate_japan_choshu.9.t
	desc = shogunate_japan_choshu.9.d
	
	is_triggered_only = yes
	
	#How could this happen
	option = {
		name = shogunate_japan_choshu.9.a
		ai_chance = { factor = 100 }
		add_stability = -0.15
		add_war_support = -0.25
	}
	
}

#Choshu Loses
country_event = {
	id = shogunate_japan_choshu.10
	title = shogunate_japan_choshu.10.t
	desc = shogunate_japan_choshu.10.d
	
	is_triggered_only = yes
	
	#Humiliating Defeat
	option = {
		name = shogunate_japan_choshu.10.a
		ai_chance = { factor = 100 }
		# add_ideas = TSH_choshu_defeat
	}
	
}

#Shogunate Wins
country_event = {
	id = shogunate_japan_choshu.11
	title = shogunate_japan_choshu.11.t
	desc = shogunate_japan_choshu.11.d
	
	is_triggered_only = yes
	
	#We disciplined Choshu
	option = {
		name = shogunate_japan_choshu.11.a
		ai_chance = { factor = 100 }
		# add_ideas = TSH_upheld_authority
	}
	
}

#Draw
country_event = {
	id = shogunate_japan_choshu.12
	title = shogunate_japan_choshu.12.t
	desc = shogunate_japan_choshu.12.d
	
	is_triggered_only = yes
	
	#Ok
	option = {
		name = shogunate_japan_choshu.12.a
		ai_chance = { factor = 100 }
	}
	
}

#Shogunate notified Satsuma does not support
country_event = {
	id = shogunate_japan_choshu.13
	title = shogunate_japan_choshu.13.t
	desc = shogunate_japan_choshu.13.d
	
	is_triggered_only = yes
	
	#We will take on both of them
	option = {
		name = shogunate_japan_choshu.13.a
		ai_chance = { factor = 100 }
		start_border_war = {
			change_state_after_war = no
			attacker = {
				state = 1261
				num_provinces = 1
				on_win = shogunate_japan_choshu.17
				on_lose = shogunate_japan_choshu.15
				on_cancel = shogunate_japan_choshu.18
			}
			defender = {
				state = 1210
				num_provinces = 1
				on_win = shogunate_japan_choshu.14
				on_lose = shogunate_japan_choshu.16
				on_cancel = secondopiumwar.18
			}
		}
		SAT = { country_event = { id = shogunate_japan_choshu.20 days = 1 } }
		hidden_effect = {
			CHO = { country_event = { id = shogunate_japan_choshu.19 } }
		}
	}

}

#Choshu Wins
country_event = {
	id = shogunate_japan_choshu.14
	title = shogunate_japan_choshu.14.t
	desc = shogunate_japan_choshu.14.d
	
	is_triggered_only = yes
	
	#We prevail
	option = {
		name = shogunate_japan_choshu.14.a
		ai_chance = { factor = 100 }
		# add_ideas = TSH_righteous_fury
	}
	
}

#Shogunate Loses
country_event = {
	id = shogunate_japan_choshu.15
	title = shogunate_japan_choshu.15.t
	desc = shogunate_japan_choshu.15.d
	
	is_triggered_only = yes
	
	#How could this happen
	option = {
		name = shogunate_japan_choshu.15.a
		ai_chance = { factor = 100 }
		add_stability = -0.05
		add_war_support = -0.1
	}
	
}

#Choshu Loses
country_event = {
	id = shogunate_japan_choshu.16
	title = shogunate_japan_choshu.16.t
	desc = shogunate_japan_choshu.16.d
	
	is_triggered_only = yes
	
	#Humiliating Defeat
	option = {
		name = shogunate_japan_choshu.16.a
		ai_chance = { factor = 100 }
	}
	
}

#Shogunate Wins
country_event = {
	id = shogunate_japan_choshu.17
	title = shogunate_japan_choshu.17.t
	desc = shogunate_japan_choshu.17.d
	
	is_triggered_only = yes
	
	#We disciplined Choshu
	option = {
		name = shogunate_japan_choshu.17.a
		ai_chance = { factor = 100 }
		annex_country = { target = CHO transfer_troops = no }
	}
	
}

#Draw
country_event = {
	id = shogunate_japan_choshu.18
	title = shogunate_japan_choshu.18.t
	desc = shogunate_japan_choshu.18.d
	
	is_triggered_only = yes
	
	#Ok
	option = {
		name = shogunate_japan_choshu.18.a
		ai_chance = { factor = 100 }
	}
	
}

#Choshu will defend
country_event = {
	id = shogunate_japan_choshu.19
	title = shogunate_japan_choshu.19.t
	desc = shogunate_japan_choshu.19.d
	
	is_triggered_only = yes
	
	#For our clan
	option = {
		name = shogunate_japan_choshu.19.a
		ai_chance = { factor = 100 }
		custom_effect_tooltip = eoanb_tt_sjc_19
		hidden_effect = {
			load_oob = "CHO_first_expedition_irregulars"
		}
	}
	
}

#Shogunate Expedition arrives in Satsuma
country_event = {
	id = shogunate_japan_choshu.20
	title = shogunate_japan_choshu.20.t
	desc = shogunate_japan_choshu.20.d
	
	is_triggered_only = yes
	
	#Entrench and wait for them to attack
	option = {
		name = shogunate_japan_choshu.20.a
		ai_chance = { factor = 50 }
		1257 = { add_building_construction = { type = bunker level = 1 instant_build = yes province = 13910 } }
		1257 = { add_building_construction = { type = bunker level = 1 instant_build = yes province = 13912 } }
		start_border_war = {
			change_state_after_war = no
			attacker = {
				state = 1258
				num_provinces = 1
				on_win = shogunate_japan_choshu.21
				on_lose = shogunate_japan_choshu.21
				on_cancel = shogunate_japan_choshu.21
			}
			defender = {
				state = 1257
				num_provinces = 1
				on_win = shogunate_japan_choshu.21
				on_lose = shogunate_japan_choshu.21
				on_cancel = secondopiumwar.21
			}
		}
	}
	
	#Try to strike first
	option = {
		name = shogunate_japan_choshu.20.b
		ai_chance = { factor = 50 }
		start_border_war = {
			change_state_after_war = no
			attacker = {
				state = 1257
				num_provinces = 1
				on_win = shogunate_japan_choshu.21
				on_lose = shogunate_japan_choshu.21
				on_cancel = shogunate_japan_choshu.21
			}
			defender = {
				state = 1258
				num_provinces = 1
				on_win = shogunate_japan_choshu.21
				on_lose = shogunate_japan_choshu.21
				on_cancel = shogunate_japan_choshu.21
			}
		}
	}
	
}

#Ceasefire
country_event = {
	id = shogunate_japan_choshu.21
	title = shogunate_japan_choshu.21.t
	desc = shogunate_japan_choshu.21.d
	
	is_triggered_only = yes
	
	#Ok
	option = {
		name = shogunate_japan_choshu.21.a
		ai_chance = { factor = 100 }
		if = {
			limit = { tag = TSH }
			hidden_effect = { country_event = { id = shogunate_japan_boshin.1 days = 50 } }
		}
	}
}

country_event = {
	id = shogunate_japan_boshin.1
	hidden = yes

	is_triggered_only = yes

	trigger = { tag = TSH }

	immediate = {
		clr_global_flag = TSH_Bakumatsu_Debate_Ongoing
		set_country_flag = TSH_Boshin_War_Ongoing
		if = {
			limit = { eoanb_enable_autonomy = yes }
			TSH = {
				set_autonomy = {
					target = CHO
					autonomy_state = autonomy_free
				}
				set_autonomy = {
					target = TOS
					autonomy_state = autonomy_free
				}
				set_autonomy = {
					target = SAT
					autonomy_state = autonomy_free
				}
				set_autonomy = {
					target = SAG
					autonomy_state = autonomy_free
				}
				set_autonomy = {
					target = MIT
					autonomy_state = autonomy_free
				}
			}
		}
		else = {
			end_puppet = CHO
			end_puppet = TOS
			end_puppet = SAG
			end_puppet = SAT
			end_puppet = MIT
		}
		CHO = {
			create_faction = "Satcho Alliance"
			declare_war_on = {
				target = TSH
				type = annex_everything
			}
		}
		every_country = {
			limit = { is_japanese_country = yes }
			CHO = { add_to_faction = THIS }
			declare_war_on = {
				target = TSH
				type = annex_everything
			}
		}
		UCT = { country_event = shogunate_japan_boshin.2 }
		country_event = shogunate_japan_boshin.10
	}
	
	option = {
		name = shogunate_japan_boshin.1.a
		ai_chance = { factor = 100 }
	}
}

country_event = {
	id = shogunate_japan_boshin.2
	hidden = yes

	
	is_triggered_only = yes

	trigger = { tag = UCT }

	immediate = {
		if = {
			limit = { TSH = { has_war = no } }
			clr_global_flag = TSH_Boshin_War_Ongoing
			if = {
				limit = { CHO = { exists = yes is_subject = no } }
				country_event = { id = shogunate_japan_boshin.8 } # Daimyo
			}
			else = {
				country_event = shogunate_japan_boshin.7 # # Meiji
			}
		}
		else = {
			country_event = { id = shogunate_japan_boshin.2 days = 10 }
			if = {
				limit = { NOT = { controls_state = 282 } has_government = autocracy }
				country_event = { id = shogunate_japan_boshin.9 } # Ouestu
			}
		}
	}
	
	option = {
		name = shogunate_japan_boshin.2.a
		ai_chance = { factor = 100 }
	}
}

# Meiji
country_event = {
	id = shogunate_japan_boshin.7
	desc = shogunate_japan_boshin.8.d
	title = shgounate_japan_boshin.8.t

	is_triggered_only = yes

	immediate = {
		every_country = {
			limit = { is_japanese_country = yes NOT = { tag = RYU } }
			if = {
				limit = { is_ai = no NOT = { tag = TSH } }
				JAP = { change_tag_from  = THIS }
			}
			every_owned_state = {
				remove_core_of = PREV
				remove_core_of = TSH
				add_core_of = JAP
				JAP = { transfer_state = PREV }
			}
		}
		JAP = {
			inherit_technology = CHO
			set_popularities = {
				autocracy = 100
			}
			set_politics = { ruling_party = autocracy }
		}
	}
	
	option = {
		name = shogunate_japan_boshin.8.a
		ai_chance = { factor = 100 }
	}
}

# Daimyo Republic
country_event = {
	id = shogunate_japan_boshin.8
	hidden = yes

	is_triggered_only = yes

	immediate = {
		TSH = {
			set_cosmetic_tag = TSH_Daimyo_Republic_Cosmetic
			set_politics = {
				ruling_party = radical_democracy
			}
			set_popularities = {
				radical_democracy = 100
			}
			set_party_name = {
				ideology = radical_democracy
				name = "Daimyo"
				long_name = "Daimyo Council"
			}
			every_country = {
				limit = { is_japanese_country = yes }
				TSH = {
					annex_country = {
						target = PREV
						transfer_troops = yes
					}
				}
			}
		}
	}
	
	option = {
		name = shogunate_japan_boshin.8.a
		ai_chance = { factor = 100 }
	}
}

# Daimyo Republic
country_event = {
	id = shogunate_japan_boshin.9
	hidden = yes

	is_triggered_only = yes

	immediate = {
		TSH = {
			set_cosmetic_tag = TSH_Ouestu_Alliance
			set_politics = { ruling_party = radical_democracy }
				set_party_name = {
				ideology = radical_democracy
				name = "Daimyo"
				long_name = "Daimyo Council"
			}
			create_country_leader = {
				name = "Yoshihisa Kitashirakawa"
				desc = "POLITICS_GENERIC_EOANB_DESC"
				picture = "gfx/leaders/TSH/Portrait_TSH_Komatsu_Akihito.dds"
				expire = "1900.1.1"
				ideology = reactionary
				traits = { }
			}
			every_country = {
				limit = { is_subject_of = TSH }
				TSH = {
						annex_country = {
						target = PREV
						transfer_troops = yes
					}
				}
			}
		}
	}
	
	option = {
		name = shogunate_japan_boshin.9.a
		ai_chance = { factor = 100 }
	}
}

###FLAVOUR & MISC###

#1858 Hietsu Earthquake
country_event = {
	id = shogunate_japan_fl.0
	title = shogunate_japan_fl.0.t
	desc = shogunate_japan_fl.0.d
	picture = GFX_report_event_generic_ruins
	
	is_triggered_only = yes

	fire_only_once = yes

	option = {
			name = shogunate_japan_fl.0.a

			add_stability = -0.005

			535 = { #Echizen/Nagano

			damage_building = {
				type = infrastructure
				damage = 0.4
			}
		}
	}
}

#Iemochi becomes Shogun, news event.
news_event = {
	id = tsh_news.0
	title = tsh_news.0.t
	desc = tsh_news.0.d
	picture = GFX_shogun_candidate_win

	major = yes

	is_triggered_only = yes

	#Edo has a new ruler
	option = {
		name = tsh_news.0.a
		trigger = { NOT = { TAG = TSH } }
	}

	#Iemochi Banzai!
	option = {
		name = tsh_news.0.b
		trigger = { TAG = TSH }
	}
}

#Yoshinobu becomes Shogun, news event.
news_event = {
	id = tsh_news.1
	title = tsh_news.1.t
	desc = tsh_news.1.d
	picture = GFX_shogun_candidate_win

	major = yes

	is_triggered_only = yes

	#Edo has a new ruler
	option = {
		name = tsh_news.1.a
		trigger = { NOT = { TAG = TSH } }
	}

	#Yoshinobu Banzai!
	option = {
		name = tsh_news.1.b
		trigger = { TAG = TSH }
	}
}

country_event = {
	id = shogunate_japan_boshin_anticheat.1
	hidden = yes

	is_triggered_only = yes
	trigger = {
		has_idea = TSH_Spirit_Unpopular_Shogunate_1
		original_tag = TSH
		NOT = { has_global_flag = TSH_Boshin_War_Ongoing }
	}

	immediate = {
		country_event = { id = shogunate_japan_boshin_anticheat.1 days = 80 random_days = 20 }
		hidden_effect = {
			# TSH_Shogun_Spread_Influence_Modify = yes
		}
	}
}
