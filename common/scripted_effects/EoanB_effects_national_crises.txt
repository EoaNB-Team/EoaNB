# GENERIC SETUP
	EOANBSYS_national_crisis_setup = {
		ROOT = {
			if = {
				limit = { has_country_flag = EOANBSYS_national_crisis_risorgimento_crisis_flag }
				add_ideas = { idea_Risorgimento_21 }
			}
			else = {
				add_ideas = { EOANBSYS_spirit_national_crisis }
			}
			set_variable = { EOANBSYS_national_crisis_progress_var = 50 }
			# Crisises that update once 2 week
			if = {
				limit = {
					has_national_crisis_14 = yes
 				}
				activate_mission = EOANBSYS_national_crisis_progress_counter_14
			}
			# Crisises that update once a month
			else_if = {
				limit = {
					has_national_crisis_30 = yes
				}
				activate_mission = EOANBSYS_national_crisis_progress_counter_30
			}
			# Crisises that update once 2 months
			else_if = {
				limit = {
					has_national_crisis_60 = yes
				}
				activate_mission = EOANBSYS_national_crisis_progress_counter_60
			}
			# Crisises that update once 3 months
			else_if = {
				limit = {
					has_national_crisis_90 = yes
				}
				activate_mission = EOANBSYS_national_crisis_progress_counter_90
			}
		}
	}

	EOANBSYS_national_crisis_clear = {
		ROOT = {
			remove_ideas = EOANBSYS_spirit_national_crisis
			increase_ps_by_one = yes
			hidden_effect = {
				clear_variable = EOANBSYS_national_crisis_progress_var
				remove_mission = EOANBSYS_national_crisis_progress_counter_14
				remove_mission = EOANBSYS_national_crisis_progress_counter_30
				remove_mission = EOANBSYS_national_crisis_progress_counter_60
				remove_mission = EOANBSYS_national_crisis_progress_counter_90
				clr_country_flag = EOANBSYS_national_crisis_bakumatsu_crisis_flag
				clr_country_flag = EOANBSYS_national_crisis_risorgimento_crisis_flag
				clr_country_flag = EOANBSYS_national_crisis_luddite_movement_flag
				clr_country_flag = EOANBSYS_national_crisis_aspirations_for_liberty_crisis_flag
				clr_country_flag = EOANBSYS_national_crisis_worker_revolt_crisis_flag
				clr_country_flag = EOANBSYS_national_crisis_military_coup_crisis_flag
				clr_country_flag = EOANBSYS_national_crisis_military_coup_crisis_flag
				clr_country_flag = EOANBSYS_national_crisis_bakumatsu_crisis_flag
				clr_country_flag = EOANBSYS_national_crisis_risorgimento_crisis_flag
				clr_country_flag = EOANBSYS_national_crisis_aspirations_for_liberty_crisis_flag
				clr_country_flag = EOANBSYS_national_crisis_worker_revolt_crisis_flag
			}
		}
	}

# Modify
	EOANBSYS_national_crisis_progress_add_one = {
		add_to_variable = {
			EOANBSYS_national_crisis_progress_var = 1
			tooltip = EOANBSYS_national_crisis_progress_add_tt
		}
	}

	EOANBSYS_national_crisis_progress_add_two = {
		add_to_variable = {
			EOANBSYS_national_crisis_progress_var = 2
			tooltip = EOANBSYS_national_crisis_progress_add_tt
		}
	}

	EOANBSYS_national_crisis_progress_add_three = {
		add_to_variable = {
			EOANBSYS_national_crisis_progress_var = 3
			tooltip = EOANBSYS_national_crisis_progress_add_tt
		}
	}

	EOANBSYS_national_crisis_progress_add_five = {
		add_to_variable = {
			EOANBSYS_national_crisis_progress_var = 5
			tooltip = EOANBSYS_national_crisis_progress_add_tt
		}
	}

	EOANBSYS_national_crisis_progress_add_ten = {
		add_to_variable = {
			EOANBSYS_national_crisis_progress_var = 10
			tooltip = EOANBSYS_national_crisis_progress_add_tt
		}
	}

	EOANBSYS_national_crisis_progress_add_twenty = {
		add_to_variable = {
			EOANBSYS_national_crisis_progress_var = 20
			tooltip = EOANBSYS_national_crisis_progress_add_tt
		}
	}

	EOANBSYS_national_crisis_progress_minus_one = {
		add_to_variable = {
			EOANBSYS_national_crisis_progress_var = -1
			tooltip = EOANBSYS_national_crisis_progress_minus_tt
		}
	}

	EOANBSYS_national_crisis_progress_minus_two = {
		add_to_variable = {
			EOANBSYS_national_crisis_progress_var = -2
			tooltip = EOANBSYS_national_crisis_progress_minus_tt
		}
	}

	EOANBSYS_national_crisis_progress_minus_three = {
		add_to_variable = {
			EOANBSYS_national_crisis_progress_var = -3
			tooltip = EOANBSYS_national_crisis_progress_minus_tt
		}
	}

	EOANBSYS_national_crisis_progress_minus_five = {
		add_to_variable = {
			EOANBSYS_national_crisis_progress_var = -5
			tooltip = EOANBSYS_national_crisis_progress_minus_tt
		}
	}

	EOANBSYS_national_crisis_progress_minus_ten = {
		add_to_variable = {
			EOANBSYS_national_crisis_progress_var = -10
			tooltip = EOANBSYS_national_crisis_progress_minus_tt
		}
	}

	EOANBSYS_national_crisis_progress_minus_twenty = {
		add_to_variable = {
			EOANBSYS_national_crisis_progress_var = -20
			tooltip = EOANBSYS_national_crisis_progress_minus_tt
		}
	}

# Bakumatsu Crisis
	EOANBSYS_national_crisis_bakumatsu_crisis_update = {
		if = {
			limit = {
				date < 1866.7.1
				check_variable = {
					EOANBSYS_national_crisis_progress_var > 80
				}
			}
			hidden_effect = {
				country_event = { id = JAP_tokugawa_shogunate.197 days = 10 random_days = 5 }
			}
		}
		else_if = {
			limit = {
				date <1865.1.1
				check_variable = {
					EOANBSYS_national_crisis_progress_var < 35
				}
			}
			hidden_effect = {
				country_event = { id = JAP_tokugawa_shogunate.196 days = 2 random_days = 5 }
			}
		}
		else_if = {
			limit = {
				date < 1867.7.1
				check_variable = {
					EOANBSYS_national_crisis_progress_var > 90
				}
			}
			hidden_effect = {
				country_event = { id = JAP_tokugawa_shogunate.197 days = 10 random_days = 5 }
			}
		}
	}
	EOANBSYS_national_crisis_bakumatsu_crisis_succeed = {
		complete_national_focus = JAP_vic_kobu_gattai
		clr_country_flag = PS_pol_disable_coups
	}
	EOANBSYS_national_crisis_bakumatsu_crisis_fail = {
		EOANBSYS_national_crisis_clear = yes
		country_event = JAP_tokugawa_shogunate.200
		clr_country_flag = PS_pol_disable_coups
	}
	
# Risorgimento Popularity National Crisis
	EOANBSYS_national_crisis_risorgimento_crisis_update = {

		if = {
			limit = {
				check_variable = {
					EOANBSYS_national_crisis_progress_var < 21
				}
			}
			hidden_effect = {
				swap_ideas = {
					remove_idea = idea_Risorgimento_21
					add_idea = idea_Risorgimento_0
				}
			}
		}	
		else_if = {
			limit = {
				check_variable = {
					EOANBSYS_national_crisis_progress_var < 41
				}
				
				check_variable = { 
					EOANBSYS_national_crisis_progress_var > 20
				}
			}
			hidden_effect = {
				if = {
					limit = { has_idea = idea_Risorgimento_0 }
					swap_ideas = {
						remove_idea = idea_Risorgimento_0
						add_idea = idea_Risorgimento_21
					}
				}
				else_if = {
					limit = { has_idea = idea_Risorgimento_41 }
					swap_ideas = {
						remove_idea = idea_Risorgimento_41
						add_idea = idea_Risorgimento_21
					}
				}
			}
		}
		else_if = {
			limit = {
				check_variable = {
					EOANBSYS_national_crisis_progress_var < 61
				}
				check_variable = {
					EOANBSYS_national_crisis_progress_var > 40
				}
			}
			hidden_effect = {
				if = {
					limit = { has_idea = idea_Risorgimento_21 }
					swap_ideas = {
						remove_idea = idea_Risorgimento_21
						add_idea = idea_Risorgimento_41
					}
				}
				else_if = {
					limit = { has_idea = idea_Risorgimento_61 }
					swap_ideas = {
						remove_idea = idea_Risorgimento_61
						add_idea = idea_Risorgimento_41
					}
				}
			}
		}
		else_if = {
			limit = {
				check_variable = {
					EOANBSYS_national_crisis_progress_var < 81
				}
				check_variable = {
					EOANBSYS_national_crisis_progress_var > 60
				}
			}
			hidden_effect = {
				if = {
					limit = { has_idea = idea_Risorgimento_41 }
					swap_ideas = {
						remove_idea = idea_Risorgimento_41
						add_idea = idea_Risorgimento_61
					}
				}
				else_if = {
					limit = { has_idea = idea_Risorgimento_81 }
					swap_ideas = {
						remove_idea = idea_Risorgimento_81
						add_idea = idea_Risorgimento_61
					}
				}
			}
		}
		
		else_if = {
			limit = {
				check_variable = {
					EOANBSYS_national_crisis_progress_var < 100
				}
				check_variable = {
					EOANBSYS_national_crisis_progress_var > 80
				}
			}
			hidden_effect = {
				if = {
					limit = { has_idea = idea_Risorgimento_61 }
					swap_ideas = {
						remove_idea = idea_Risorgimento_61
						add_idea = idea_Risorgimento_81
					}
				}
			}
		}
	}
	
	EOANBSYS_national_crisis_risorgimento_crisis_succeed = {
		EOANBSYS_national_crisis_clear = yes
		
		if = {
			limit = {
				has_idea = idea_Risorgimento_0
			}
			remove_ideas =  {
				idea_Risorgimento_0
			}
		}
		else_if = {
			limit = {
				has_idea = idea_Risorgimento_21
			}
			remove_ideas =  {
				idea_Risorgimento_21
			}
		}
		else_if = {
			limit = {
				has_idea = idea_Risorgimento_41
			}
			remove_ideas =  {
				idea_Risorgimento_41
			}
		}
		else_if = {
			limit = {
				has_idea = idea_Risorgimento_61
			}
			remove_ideas =  {
				idea_Risorgimento_61
			}
		}
		else_if = {
			limit = {
				has_idea = idea_Risorgimento_81
			}
			remove_ideas =  {
				idea_Risorgimento_81
			}
		}
	}
	
	EOANBSYS_national_crisis_risorgimento_crisis_fail = {
		EOANBSYS_national_crisis_clear = yes
		if = {
			limit = {
				tag = PRM
			}
			set_politics = { 
				ruling_party = democratic_socialism
			}
			add_popularity = {
				ideology = democratic_socialism
				popularity = 0.5
			}
			PRM_Italian_Revolutionaries = {
				promote_character = democratic_socialism
			}
			set_cosmetic_tag = PRM_Rebels
		}
		else = {
			set_politics = { 
				ruling_party = centrism
			}
			set_popularities = {
				centrism = 90
				autocracy = 10
			}
		}
		if = {
			limit = {
				has_idea = idea_Risorgimento_81
			}
			remove_ideas =  {
				idea_Risorgimento_81
			}
		}
		else_if = {
			limit = {
				has_idea = idea_Risorgimento_61
			}
			remove_ideas =  {
				idea_Risorgimento_61
			}
		}
	}
	

d_national_crisis_set_fragmentation = {
	ROOT = {
		set_variable = {
			var = EOANBSYS_national_crisis_progress_var
			value = args^0
		}
	}
}

d_national_crisis_add_fragmentation = {
	ROOT = {
		add_to_variable = {
			var = EOANBSYS_national_crisis_progress_var
			value = args^0
		}
	}
}	